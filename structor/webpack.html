<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack | 知识文章</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="This is a blog.">
    <link rel="preload" href="/blog/assets/css/0.styles.eea3ff88.css" as="style"><link rel="preload" href="/blog/assets/js/app.a3423334.js" as="script"><link rel="preload" href="/blog/assets/js/2.a973bc12.js" as="script"><link rel="preload" href="/blog/assets/js/41.91a0c3cd.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.874ad3ec.js"><link rel="prefetch" href="/blog/assets/js/11.0711065f.js"><link rel="prefetch" href="/blog/assets/js/12.c40d93da.js"><link rel="prefetch" href="/blog/assets/js/13.da43d7f3.js"><link rel="prefetch" href="/blog/assets/js/14.5f50c20e.js"><link rel="prefetch" href="/blog/assets/js/15.d82d9cf0.js"><link rel="prefetch" href="/blog/assets/js/16.ff02c56f.js"><link rel="prefetch" href="/blog/assets/js/17.902c3621.js"><link rel="prefetch" href="/blog/assets/js/18.690ad6d6.js"><link rel="prefetch" href="/blog/assets/js/19.e8feab27.js"><link rel="prefetch" href="/blog/assets/js/20.1d7fcf1c.js"><link rel="prefetch" href="/blog/assets/js/21.16c4ed2a.js"><link rel="prefetch" href="/blog/assets/js/22.2aefa173.js"><link rel="prefetch" href="/blog/assets/js/23.4e5640f3.js"><link rel="prefetch" href="/blog/assets/js/24.ba1b495a.js"><link rel="prefetch" href="/blog/assets/js/25.e8666563.js"><link rel="prefetch" href="/blog/assets/js/26.5787142e.js"><link rel="prefetch" href="/blog/assets/js/27.b2722766.js"><link rel="prefetch" href="/blog/assets/js/28.5aa26eb0.js"><link rel="prefetch" href="/blog/assets/js/29.3d2624e8.js"><link rel="prefetch" href="/blog/assets/js/3.f86f4f75.js"><link rel="prefetch" href="/blog/assets/js/30.29661336.js"><link rel="prefetch" href="/blog/assets/js/31.447afcaa.js"><link rel="prefetch" href="/blog/assets/js/32.c2bd8e9a.js"><link rel="prefetch" href="/blog/assets/js/33.797423e5.js"><link rel="prefetch" href="/blog/assets/js/34.ee1d27eb.js"><link rel="prefetch" href="/blog/assets/js/35.89ff95b9.js"><link rel="prefetch" href="/blog/assets/js/36.a6567a31.js"><link rel="prefetch" href="/blog/assets/js/37.e0cd8c86.js"><link rel="prefetch" href="/blog/assets/js/38.4ca67963.js"><link rel="prefetch" href="/blog/assets/js/39.4bec9a8a.js"><link rel="prefetch" href="/blog/assets/js/4.221a248a.js"><link rel="prefetch" href="/blog/assets/js/40.6b72df98.js"><link rel="prefetch" href="/blog/assets/js/42.c495687d.js"><link rel="prefetch" href="/blog/assets/js/43.fc90ceb9.js"><link rel="prefetch" href="/blog/assets/js/44.5da0fdd6.js"><link rel="prefetch" href="/blog/assets/js/5.d9260729.js"><link rel="prefetch" href="/blog/assets/js/6.e532ac18.js"><link rel="prefetch" href="/blog/assets/js/7.d43e6edf.js"><link rel="prefetch" href="/blog/assets/js/8.0d7bba76.js"><link rel="prefetch" href="/blog/assets/js/9.d2e1456d.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.eea3ff88.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">知识文章</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/TimYao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/TimYao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/jsdoc.html" class="sidebar-link">JS</a></li><li><a href="/blog/all.html" class="sidebar-link">Html/Css</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端框架</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/blog/test.html" class="sidebar-link">测试</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>构建工具</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/structor/webpack.html" class="active sidebar-link">webpack</a></li><li><a href="/blog/structor/tapable.html" class="sidebar-link">tapable</a></li><li><a href="/blog/structor/webpack-cli.html" class="sidebar-link">webpack-cli</a></li><li><a href="/blog/structor/webpack-hmr.html" class="sidebar-link">webpack-hmr</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>服务端</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/blog/replease.html" class="sidebar-link">发布上线</a></li><li><a href="/blog/expand.html" class="sidebar-link">扩展知识</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>源码分析</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/blog/resource.html" class="sidebar-link">资料</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>项目实践</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/blog/sf.html" class="sidebar-link">算法学习</a></li><li><a href="/blog/408.html" class="sidebar-link">计算机408课本</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="webpack"><a href="#webpack" class="header-anchor">#</a> webpack</h2> <p>webpack 是一个款打包工具，为了更好的管理资源，可以把各种各样的模块打包成JS，统一做相应处理</p> <h2 id="基本常用用法"><a href="#基本常用用法" class="header-anchor">#</a> 基本常用用法</h2> <p>webpack 分为几个基本配置context相对处理目录设置，entry入口，output出口，module模块预处理，resolve模块查找相关配置，plugin插件处理，devServer本地服务配置，devtool开发模式源码映射配置</p> <ul><li><p>entry</p> <p>打包入口配置，单入口以字符串格式，多入口以对象格式配置，多模块合并以数组格式</p></li> <li><p>output</p> <p>path 打包输出路径</p> <p>filename生成的文件（[name/id/hash]）</p> <p>chunkFileName 懒加载生成文件</p> <p>publicPath 静态地址指定</p> <p>library  对外暴露的变量</p> <p>libraryTarget 所使用的环境 umd/commonjs/commonjs2/var 根据不同环境打包出适应的脚本</p></li> <li><p>module</p> <p>noParse 对于加载模块，不依赖其他模块设置不解析为了减少模块分析与导入</p> <p>rules: 多条处理规则配置，针对不同的文件做不同处理</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token punctuation">[</span>
   <span class="token punctuation">{</span>
     test<span class="token operator">:</span> <span class="token regex">/regexp/</span><span class="token punctuation">,</span><span class="token comment">//匹配规则</span>
     <span class="token comment">// 'babel-loader'| ['babel-loader'] | [{loader: 'babel-loader', options:{}}]</span>
     use<span class="token operator">:</span> <span class="token punctuation">(</span>string<span class="token operator">|</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token comment">// 排除目录</span>
     exclude<span class="token operator">:</span> <span class="token punctuation">(</span>string<span class="token operator">|</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token comment">// 包含目录</span>
     include<span class="token operator">:</span> <span class="token punctuation">(</span>string<span class="token operator">|</span>string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">]</span>
</code></pre></div></li> <li><p>resolve</p> <p>由于模块解析处理规则相关配置</p> <p>module解析模块的查找模块目录配置</p> <p>mainFile导入模块配置导入识别的文件默认index.js</p> <p>mainFiled导入模块对packJson下优先导入字段对应文件的配置</p> <p>alias提供可以更好更简单的引入模块路径，别名话简单</p></li> <li><p>plugin</p> <p>处理在loader处理不了的其他情况</p></li> <li><p>devServer</p> <p>配置本地启动服务，完成本地开发的灵活性运用</p> <p>port/proxy/publicPath/contentBase...</p></li> <li><p>devtool</p> <p>对打包编码的source map映射，可以在调试bug更快找到源码出错位置，不同的值会明显影响到构建(build)和重新构建(rebuild)的速度</p> <p>none 构建与重新构建速度三星，适应生成环境，打包后的代码</p> <p>eval 构建与重新构建速度三星，不适应生成环境，生成后的代码</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&quot;\n\n__webpack_require__(/*! ./css/index.css */ \&quot;./src/css/index.css\&quot;);\n\n//# sourceURL=webpack:///./src/index.js?&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>cheap-eval-source-map 构建一星与重新构建二星，不适应生成环境，转换过的代码（仅限行）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&quot;\n\n__webpack_require__(/*! ./css/index.css */ \&quot;./src/css/index.css\&quot;);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvaW5kZXguanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvaW5kZXguanM/N2U5MCJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxucmVxdWlyZShcIi4vY3NzL2luZGV4LmNzc1wiKTsiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./src/index.js\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>cheap-module-eval-source-map  构建0与重新构建二星，不适应生成环境，原始源代码（仅限行）</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">&quot;\n\n__webpack_require__(/*! ./css/index.css */ \&quot;./src/css/index.css\&quot;);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9zcmMvaW5kZXguanMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vYmFiZWwtYS5qcz80Y2QwIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIGltcG9ydCBpbWcgZnJvbSAnLi9pbWFnZXMvaW1nLmpwZyc7XG5pbXBvcnQgJy4vY3NzL2luZGV4LmNzcyc7XG4vLyBsZXQgbG9hZGluZ0ltZyA9ICgpID0+IHtcbi8vICAgY29uc3QgaW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbi8vICAgaW0uc3JjID0gaW1nO1xuLy8gICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGltKTtcbi8vIH1cbi8vIGxvYWRpbmdJbWcoKTtcbi8vIGltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG4vLyBpbXBvcnQge25hbWVkfSBmcm9tICcuL2EuanMnXG4vLyBpbXBvcnQgbSAgZnJvbSAnLi9hLmpzb24nXG4vLyBjb25zb2xlLmxvZygnaW5kZXgganMnLCBuYW1lZCwgbSk7Il0sIm1hcHBpbmdzIjoiOztBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/index.js\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>cheap-source-map 构建一星与重新构建0，适应生成环境，转换过的代码（仅限行）</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">//# sourceMappingURL=main.bundle.js.map</span>
</code></pre></div><p>cheap-module-source-map 构建0与重新构建负一星，适应生成环境，原始源代码（仅限行）</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">//# sourceMappingURL=main.bundle.js.map</span>
</code></pre></div><p>inline-cheap-source-map 构建一星与重新构建0，不适应生成环境，转换过的代码（仅限行）</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5idW5kbGUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2Nzcy9pbmRleC5jc3MiLCJ3ZWJwYWNrOi8vLy4vc3JjL2Nzcy90LmNzcyIsIndlYnBhY2s6Ly8vLi9zcmMvY3NzL2luZGV4LmNzcz80NzQ0Iiwid2VicGFjazovLy8uL3NyYy9pbWFnZXMvaW1nLmpwZyIsIndlYnBhY2s6Ly8vLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IFwiLi9zcmMvaW5kZXguanNcIik7XG4iLCJtb2R1bGUuZXhwb3J0cz1gYCtyZXF1aXJlKFwiISFjc3MtbG9hZGVyIS4vdC5jc3NcIikrYFxuYm9keXtcbiAgY29sb3I6IHJlZDtcbiAgYmFja2dyb3VuZC1pbWFnZTogdXJsKFwiYCtyZXF1aXJlKFwiLi4vaW1hZ2VzL2ltZy5qcGdcIikrYFwiKTtcbn1gIiwibW9kdWxlLmV4cG9ydHM9YFxuYm9keXtcbiAgZm9udC1zaXplOiAyNHB4O1xuICBiYWNrZ3JvdW5kLWNvbG9yOiByZWQ7XG59YCIsIlxuICAgIGNvbnN0IHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTtcbiAgICBzdHlsZS5pbm5lclRleHQgPSByZXF1aXJlKFwiISEuLi8uLi9sb2FkZXJzL2Nzcy1sb2FkZXIuanMhLi9pbmRleC5jc3NcIik7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzdHlsZSk7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSAnJztcbiAgIiwibW9kdWxlLmV4cG9ydHMgPSBcImltYWdlcy9pbWc4MWE3YjE5NTdkMTJjNTI0NTEzZjU5NmM0ODNkMWM0Ni5qcGdcIiIsIlwidXNlIHN0cmljdFwiO1xuXG5yZXF1aXJlKFwiLi9jc3MvaW5kZXguY3NzXCIpOyJdLCJtYXBwaW5ncyI6IjtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7OztBQ2xGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQ0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FDSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQ0xBOzs7Ozs7Ozs7Ozs7QUNBQTtBQUNBO0FBQ0E7Ozs7QSIsInNvdXJjZVJvb3QiOiIifQ==</span>
</code></pre></div><p>inline-cheap-module-source-map 构建0与重新构建负一星，不适应生成环境，原始源代码（仅限行）</p> <p>同上,只是对编译前的源码保留了映射</p> <p>inline-source-map 构建二星与重新构建二星，不适应生成环境，原始源代码</p> <p>同上,只是保留了映射的行列信息</p> <p>source-map 构建二星与重新构建二星，适应生成环境，原始源代码</p> <p>hidden-source-map 构建二星与重新构建二星，适应生成环境，原始源代码</p> <p>nosources-source-map 构建二星与重新构建二星，适应生成环境，无源代码内容</p> <p>eval-source-map 构建负二星与重新构建一星，不适应生成环境，原始源代码</p> <p>+++ 非常快速, ++ 快速, + 比较快, o 中等, - 比较慢, -- 慢</p> <p>其中一些值适用于开发环境，一些适用于生产环境。对于开发环境，通常希望更快速的 source map，需要添加到 bundle 中以增加体积为代价，但是对于生产环境，则希望更精准的 source map，需要从 bundle 中分离并独立存在</p> <p>eval 将代码块进行eval包裹</p> <p>inline 嵌入了脚本中，形成行内</p> <p>cheap 对于编译后的代码进行行信息监测，并且不会产生源代码的map记录</p> <p>module 对于源代码产生记录，可以调试中看到源代码</p> <p>source-map 生成独立文件</p> <p>none 不生成映射</p> <p>针对不同情况选择，上线适合轻量cheap,module,source-map,通过配置来完成私服中调试；
本地开发，eval,cheap,inline,module都可以；其中eval模式不会进行ast分析速度会更快</p> <p>https://webpack.docschina.org/configuration/devtool/</p></li> <li><p>watch</p> <p>开启监控模式，可以实时打包或编译</p></li> <li><p>watchOptions</p> <p>开启监测后的配置，对控制响应频率控制</p> <p>aggregateTimeout 增加延迟重新构建时间，聚合多次操作</p> <p>ignored 排除一些不需要监测的目录，文件</p> <p>poll 轮询监听时间</p></li></ul> <h2 id="构建优化"><a href="#构建优化" class="header-anchor">#</a> 构建优化</h2> <ul><li><p>module下的noParse配置 针对导入模块内部不存在依赖，比如jquery</p></li> <li><p>plugins 下运用webpack.ignorePlugin,对一些模块只用了一部分模块，忽略掉，手动引入需要的</p></li> <li><p>plugins webpack.DllPlugin 动态链接库,将不变的第三方模块单独打包处理，生成manifest.json文件，通过在主文件中通过webpack.DllReferencePlugin配置导入映射文件，不用重复打包第三方文件</p></li> <li><p>plugins happypack 多线程插件支持开启打包</p></li> <li><p>webpack自动提供了运用es6模块下tree-shaking,只能针对导入es6模块，会自动删除没有运用的定义的一些函数
scope hosting 作用域提升，对作用域做了整合，自动省略一些简化代码
tree-shaking: 运用import/export方法，mode: production模式开启，sideEffects: false, es6配置不转为commonjs,目前只设置mode就完成了</p></li> <li><p>抽离公共代码</p> <p>当有多文件有公用模块时</p> <div class="language-js extra-class"><pre class="language-js"><code>  webpack2<span class="token operator">:</span> commonChunkPlugin
   webpack4<span class="token operator">:</span>
   optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
     <span class="token comment">// 分割代码块</span>
     splitChunks<span class="token operator">:</span> <span class="token punctuation">{</span>
       <span class="token comment">// 缓存组</span>
       cacheGroups<span class="token operator">:</span><span class="token punctuation">{</span>
         <span class="token comment">// 公共模块</span>
         common<span class="token operator">:</span><span class="token punctuation">{</span>
           <span class="token comment">// 入口模块</span>
           chunks<span class="token operator">:</span> <span class="token string">'initial'</span><span class="token punctuation">,</span>
           <span class="token comment">// 尺寸大于多少</span>
           minSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
           <span class="token comment">// 抽离模块被引入的次数</span>
           minChunks<span class="token operator">:</span> <span class="token number">2</span>
         <span class="token punctuation">}</span><span class="token punctuation">,</span>
         vendor<span class="token operator">:</span> <span class="token punctuation">{</span>
           <span class="token comment">// 权重提高</span>
           priority<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
           <span class="token comment">// 匹配第三方模块抽离</span>
           test<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span>
           minSize<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
           minChunks<span class="token operator">:</span> <span class="token number">2</span>
         <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>懒加载</p> <p>通过es6 草案用法 import()动态载入模块，返回promise
通过异步触发来加载通过jsonp模式插入文件
需要安装插件支持@babel/plugin-syntax-dynamic-import</p></li> <li><p>热更新</p> <p>更新部分而不是全部更新</p> <div class="language-js extra-class"><pre class="language-js"><code>  devServe<span class="token operator">:</span> <span class="token punctuation">{</span>
     hot<span class="token operator">:</span> <span class="token boolean">true</span>
   <span class="token punctuation">}</span>
   plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
     <span class="token comment">// 打印更新</span>
     <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>NamedModulesPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
     <span class="token comment">// 热更新模块</span>
     <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token punctuation">]</span>
   模块文件中加入
   <span class="token keyword">if</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token comment">// 针对指定文件</span>
     module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">'./source'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./source'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
</code></pre></div></li></ul> <h2 id="webpack模块解析"><a href="#webpack模块解析" class="header-anchor">#</a> webpack模块解析</h2> <p>webpack 内部打包会实现导入模块加载的方法，比如类似node中的require模式,实现module.exports模式的支持，并通过对不同模块类型进行兼容处理(es6模块，commonjs模式)，webpack本身以commonjs规范</p> <p>特色：</p> <ol><li><p>实现了require,module.exports方式 (require = <strong>webpack_require</strong>)</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">{</span>
   i<span class="token punctuation">,</span> <span class="token comment">// 模块标识，这里为路径</span>
   l<span class="token punctuation">,</span> <span class="token comment">// 是否已经加载</span>
   exports <span class="token comment">// 模块中内容</span>
 <span class="token punctuation">}</span>
</code></pre></div><p>完成对模块中的this指向到module.exports,并对所有导出闭包模块传入了module, module.exports, require</p> <div class="language-js extra-class"><pre class="language-js"><code> modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>实现缓存存储</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">var</span> installedModules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>完成异步加载，懒加载模块导入方式</p> <p>通过对导入模块import()分析，产生调用对应的方法完成jsonp模式动态插入脚本，并最后将异步模块更新到modules列表，同步所有相关依赖模块的列表</p> <p>import方法映射的方法实现，内部实现promise模式处理</p> <div class="language-js extra-class"><pre class="language-js"><code> __webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">e</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">requireEnsure</span><span class="token punctuation">(</span><span class="token parameter">chunkId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">var</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 <span class="token comment">// JSONP chunk loading for javascript</span>

 <span class="token keyword">var</span> installedChunkData <span class="token operator">=</span> installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span>installedChunkData <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 0 means &quot;already installed&quot;.</span>
   <span class="token comment">// a Promise means &quot;currently loading&quot;.</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>installedChunkData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     promises<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>installedChunkData<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
       <span class="token comment">// setup Promise in chunk cache</span>
       <span class="token keyword">var</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         installedChunkData <span class="token operator">=</span> installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">]</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       promises<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>installedChunkData<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> promise<span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">// start chunk loading</span>
       <span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">var</span> onScriptComplete<span class="token punctuation">;</span>

       script<span class="token punctuation">.</span>charset <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">;</span>
       script<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">120</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span>nc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         script<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">&quot;nonce&quot;</span><span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">.</span>nc<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token function">jsonpScriptSrc</span><span class="token punctuation">(</span>chunkId<span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token comment">// create error before stack unwound to get useful stacktrace later</span>
       <span class="token keyword">var</span> error <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function-variable function">onScriptComplete</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token comment">// avoid mem leaks in IE.</span>
         script<span class="token punctuation">.</span>onerror <span class="token operator">=</span> script<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
         <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">var</span> chunk <span class="token operator">=</span> installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span><span class="token punctuation">;</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>chunk <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">if</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span> <span class="token punctuation">{</span>
             <span class="token keyword">var</span> errorType <span class="token operator">=</span> event <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'load'</span> <span class="token operator">?</span> <span class="token string">'missing'</span> <span class="token operator">:</span> event<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
             <span class="token keyword">var</span> realSrc <span class="token operator">=</span> event <span class="token operator">&amp;&amp;</span> event<span class="token punctuation">.</span>target <span class="token operator">&amp;&amp;</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>src<span class="token punctuation">;</span>
             error<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">'Loading chunk '</span> <span class="token operator">+</span> chunkId <span class="token operator">+</span> <span class="token string">' failed.\n('</span> <span class="token operator">+</span> errorType <span class="token operator">+</span> <span class="token string">': '</span> <span class="token operator">+</span> realSrc <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">;</span>
             error<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'ChunkLoadError'</span><span class="token punctuation">;</span>
             error<span class="token punctuation">.</span>type <span class="token operator">=</span> errorType<span class="token punctuation">;</span>
             error<span class="token punctuation">.</span>request <span class="token operator">=</span> realSrc<span class="token punctuation">;</span>
             chunk<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">}</span>
           installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token punctuation">;</span>
       <span class="token keyword">var</span> timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token function">onScriptComplete</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'timeout'</span><span class="token punctuation">,</span> target<span class="token operator">:</span> script <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">120000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       script<span class="token punctuation">.</span>onerror <span class="token operator">=</span> script<span class="token punctuation">.</span>onload <span class="token operator">=</span> onScriptComplete<span class="token punctuation">;</span>
       document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>定义window.webpackJsonp，添加push方法，并记录上一层push方式，后期实现递归完成同步modules列表,push = webpackJsonpCallback，触发更新</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">function</span> <span class="token function">webpackJsonpCallback</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">var</span> chunkIds <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">var</span> moreModules <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token comment">// add &quot;moreModules&quot; to the modules object,</span>
   <span class="token comment">// then flag all &quot;chunkIds&quot; as loaded and fire callback</span>
   <span class="token keyword">var</span> moduleId<span class="token punctuation">,</span> chunkId<span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> resolves <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> chunkIds<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     chunkId <span class="token operator">=</span> chunkIds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>installedChunks<span class="token punctuation">,</span> chunkId<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       resolves<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">for</span><span class="token punctuation">(</span>moduleId <span class="token keyword">in</span> moreModules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>moreModules<span class="token punctuation">,</span> moduleId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> moreModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>parentJsonpFunction<span class="token punctuation">)</span> <span class="token function">parentJsonpFunction</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">while</span><span class="token punctuation">(</span>resolves<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     resolves<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
 <span class="token keyword">var</span> jsonpArray <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&quot;webpackJsonp&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&quot;webpackJsonp&quot;</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 <span class="token keyword">var</span> oldJsonpFunction <span class="token operator">=</span> jsonpArray<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>jsonpArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
 jsonpArray<span class="token punctuation">.</span>push <span class="token operator">=</span> webpackJsonpCallback<span class="token punctuation">;</span>
 jsonpArray <span class="token operator">=</span> jsonpArray<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>jsonpArray<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token function">webpackJsonpCallback</span><span class="token punctuation">(</span>jsonpArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">var</span> parentJsonpFunction <span class="token operator">=</span> oldJsonpFunction<span class="token punctuation">;</span>
</code></pre></div></li> <li><p>实现多模块规范之间的兼容es6与commonjs</p> <p>总思路为：es6模块均添加Symbol.toStringTag完成对Object.prototype.toString对象类型的重新化，添加es6标识__esModule, 对模块导出应对响应的处理规则，es6模块均产生{default:{}, Symbol.toStringTag: Module, __esModule: true, 其他非default导出对象}，commonjs方式导出模块不做处理，module.exports/exports</p> <ul><li>导出es6模块，导入方式es6</li></ul> <p>标识添加，读取default,或访问对象
Module {default: {text: &quot;cc&quot;}, aa: ƒ aa(), __esModule: true, Symbol(Symbol.toStringTag): &quot;Module&quot;}</p> <div class="language-js extra-class"><pre class="language-js"><code>  __webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{</span>
    <span class="token string">&quot;./src/index.js&quot;</span><span class="token operator">:</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
      __webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> _title__WEBPACK_IMPORTED_MODULE_0__ <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token string">&quot;./src/title.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_title__WEBPACK_IMPORTED_MODULE_0__<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> _title__WEBPACK_IMPORTED_MODULE_0__<span class="token punctuation">[</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token string">&quot;./src/title.js&quot;</span><span class="token operator">:</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
      __webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">)</span><span class="token punctuation">;</span>
      __webpack_require__<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> age<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> __webpack_exports__<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">'tim'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>
</code></pre></div><ul><li>导出es6模块，导入commonjs模式</li></ul> <p>Module {default: {text: &quot;cc&quot;}, aa: ƒ aa(), __esModule: true, Symbol(Symbol.toStringTag): &quot;Module&quot;}</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token punctuation">{</span>
      <span class="token string">&quot;./src/index.js&quot;</span><span class="token operator">:</span>
      <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> m <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token string">&quot;./src/title.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

      <span class="token string">&quot;./src/title.js&quot;</span><span class="token operator">:</span>
      <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
        __webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">)</span><span class="token punctuation">;</span>
        __webpack_require__<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">,</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> age<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        __webpack_exports__<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">'tim'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  Module <span class="token punctuation">{</span><span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&quot;tim&quot;</span><span class="token punctuation">,</span> __esModule<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token string">&quot;Module&quot;</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">}</span>
</code></pre></div><ul><li>导出commonjs, 导入commonjs</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token punctuation">{</span>
    <span class="token string">&quot;./src/index.js&quot;</span><span class="token operator">:</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> title <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token string">&quot;./src/title.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token string">&quot;./src/title.js&quot;</span><span class="token operator">:</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token string">'title'</span><span class="token punctuation">;</span>
      <span class="token comment">// exports.name = 'title name';</span>
      <span class="token comment">// exports.age = 'title age';</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><ul><li>导出commonjs, 导入es6</li></ul> <p>会对commonjs模式判断是那种模式，返回对应模式处理方式，es6返回default,commonjs module</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token punctuation">{</span>
    text<span class="token operator">:</span> <span class="token string">'cc'</span>
  <span class="token punctuation">}</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    c
  <span class="token punctuation">}</span>
  <span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> m <span class="token keyword">from</span> <span class="token string">'./c'</span><span class="token punctuation">;</span>

  <span class="token punctuation">{</span>c<span class="token operator">:</span> <span class="token punctuation">{</span>text<span class="token operator">:</span> <span class="token string">&quot;cc&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>


  __webpack_require__<span class="token punctuation">.</span><span class="token function-variable function">n</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> getter <span class="token operator">=</span> module <span class="token operator">&amp;&amp;</span> module<span class="token punctuation">.</span>__esModule <span class="token operator">?</span>
    <span class="token keyword">function</span> <span class="token function">getDefault</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> module<span class="token punctuation">[</span><span class="token string">'default'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">:</span>
    <span class="token keyword">function</span> <span class="token function">getModuleExports</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> module<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>getter<span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> getter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> getter<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token punctuation">{</span>
    <span class="token string">&quot;./src/index.js&quot;</span><span class="token operator">:</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
      __webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> _title__WEBPACK_IMPORTED_MODULE_0__ <span class="token operator">=</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token string">&quot;./src/title.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> _title__WEBPACK_IMPORTED_MODULE_0___default <span class="token operator">=</span> __webpack_require__<span class="token punctuation">.</span><span class="token function">n</span><span class="token punctuation">(</span>_title__WEBPACK_IMPORTED_MODULE_0__<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_title__WEBPACK_IMPORTED_MODULE_0___default<span class="token punctuation">.</span>a<span class="token punctuation">,</span> _title__WEBPACK_IMPORTED_MODULE_0__<span class="token punctuation">[</span><span class="token string">&quot;age&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token string">&quot;./src/title.js&quot;</span><span class="token operator">:</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      exports<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'title name'</span><span class="token punctuation">;</span>
      exports<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token string">'title age'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div></li></ol> <p>总结：</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>总模块导入还是导出若模块监测出为ES6模块，统一做了添加标识{Symbol.toStringTap: &quot;Modules&quot;, __esModule: true} [object, Modules]
导出：es6, 导入：es6
这种方式将default 方式绑入module.exports.default,并将其他方式绑定到module.exports上，最后导入获取以ES6方式的{default:{}, key:value}得到</p> <p>导出：e6，导入commonjs
这种方式导出同样做es6模式处理，导入按默认commonjs方式，在获取中通过{default:{}, key:value}得到</p> <p>导出：commonjs，导入commonjs
这种方式不做任何处理，按常规的commonjs模式获取得到</p> <p>导出：commonjs,导入es6模式
这种方式导入通过判断导出对象格式为es6模式还是commonjs模式，返回模块下的default,还是默认的，并会再最后模块上定义a属性得到最后所有的模块</p> <p>es6模块在webpack的处理下表现为module.exports = {default:{}, otherKey: value, Symbol.toStringTag: &quot;Modules&quot;, __esModule: true},所以对于是commonjs方式导入，从default得到es6模块default下参数，其他获取方式不变化，commonjs格式module.exports = {}</p></div> <h2 id="webpack流程整理"><a href="#webpack流程整理" class="header-anchor">#</a> webpack流程整理</h2> <ul><li><p>由webpack-cli处理完成命令行交互，命令参数，以及相关的webpack其他脚手架</p></li> <li><p>在由webpack-cli支持后内部会调用webpack来开启webpack启动</p></li> <li><p>若不通过webpack-cli方式调用，以读取webpack.config.js来合并整合参数</p></li> <li><p>webpack内部以两种方式，一种是存在watch方式，一种是以直接调用run非观测模式</p></li> <li><p>实例化穿件compiler,compiler为管理webpack整个流程一个对象，内部提供了钩子函数和一些记录信息</p></li> <li><p>在compiler创建过程中会进行初始化一些环节配置(比如绑入输入输出模块)，执行一些插件</p></li> <li><p>查找入口，找到入口，读取入口文件，得到入口相对项目目录地址，并将其构建成模块对象，内部会有模块标识即模块相对细致，模块依赖记录作为后期在分析依赖时存储依赖模块</p></li> <li><p>整合规则中的loader，对资源与loader进行规则匹配，并整合loader类型数组，loader分为(post, inline, normal, pre)，分别处理后的以loader数组记录，在对资源的标识上除去不需要loader(!!只需要行loader,-!排除前置和普通loader,!排除普通loader),根据不同组合为最后需要处理的loader数组（[...post, ...inline, ...normal, ...pre]）通过调用loader-runner一种控制loader执行的流程模块库对loader进行循环，分别以入口模块开始读取入口文件内容，将其传入，以最后处理后的内容，将其转换为对应ast树进行依赖分析，以及部分代码的转换比如将(require方法转换为webpack内部实现的__webpack_require__模块方式)，对以require方式导入的模块再次进行(文件路径，模块建立，loader流程，ast)，模块处理完成将其存储到所属模块的记录信息中。当所有模块编辑结束后，得到了模块的依赖关系，这个过程后完成了模块编译，模块转换，模块的依赖分析</p></li> <li><p>由模块依赖关系来建立chunks,由chunks建立了assets，chunks为代码块，一个代码块是其相关的模块一个组合模块，代码块有两种，一种是由入口模块和依赖模块组成的模块，一种是异步import方式而独立的代码块，assets作为最终要发射的文件，也就是作为文件产生的模块</p></li> <li><p>在assets完成后，可对输出资源进行发射输出，完成</p></li></ul> <p>补充：</p> <ol><li><p>loader作为非脚本资源转换为可脚本处理的模块转换工具，loader分为(转换loader, 处理loader, 工具loader),转换loader完成模块转换为js可处理的js模块(babel-loader)，处理loader完成对一些功能过度(css-loader完成了对css中import的转换为require,以及路径处理)，工具loader主要是完成配合loader的处理(postcss-loader)；loader作为一个函数执行将处理内容传入，通过脚本方式导出,loader-runner作为控制loader执行流程的管理者，管理者中提供了loader context完成对整个流程的上下文的相关记录；</p></li> <li><p>loader的plugin提供了结合解耦功能的导入执行，通过插件可以增强loader功能</p></li> <li><p>plugin作为webpack中贯穿整个webpack流程，每一个插件可提供挂入的钩子，在后期webpack的执行流程中合适的时机触发执行，完成所需任务，plugin以类方式定义，内部通过提供apply方法作为入口启动口，plugin的功能要强大于loader，loader只能做部分功能，loader属于其中一个流程，plugin则贯穿了整个webpack流程中</p></li> <li><p>代码分割：</p></li></ol> <div class="language- extra-class"><pre><code>entry chunk将要合并的第三方模块整合为一个入口chunk数组中, 以入口作为最后的代码块资源产生

import chunk以异步模块方式单独作为代码块资源产生，主要以jsonp方式

split chunk针对多个模块之间共享了功能模块抽离，通过optimization下splitChunks
</code></pre></div><ol start="5"><li>hash</li></ol> <div class="language- extra-class"><pre><code>hash: 以整个编译过程中的模块标识符来通过crypto模块完成生成hash产生

chunkhash: 以入口模块以及相关的依赖模块的模块ID通过crypto模块完成生成hash产生

contenthash: 以模块内容通过crypto模块完成生成hash产生

hash的灵活性更大，变动性更大，持久性差，当任何一个模块增减变化都会影响其相关的所有模块hash变化；chunkhash因入口相关模块的变化而变化; contenthash方式计算量大，针对性更强，三者之间强度由低到高
</code></pre></div><ol start="6"><li><p>构建速度</p> <ol><li><p>针对不同环境启动相对应的source-map方式</p></li> <li><p>对于第三方模块可以实行dll方式的单独处理打包，主要原理是通过单独第三方模块配置文件，通过webpack.DllPlugin生成一个dll.js第三方库打包好的文件，并产生dll.refererce.json文件内部管理了每一个模块的映射文件，在主配置文件中通过DllReferencePlugin会通过引入dll.refererce.json判断来放弃对第三方模块的打包处理</p></li></ol></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token comment">// webpack.vendor.config.js</span>

<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  context<span class="token operator">:</span> __dirname<span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'[name]_[fullhash]'</span><span class="token punctuation">,</span>
  path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'manifest.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// webpack.app.config.js</span>

<span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  context<span class="token operator">:</span> __dirname<span class="token punctuation">,</span>
  manifest<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./manifest.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  scope<span class="token operator">:</span> <span class="token string">'xyz'</span><span class="token punctuation">,</span>
  sourceType<span class="token operator">:</span> <span class="token string">'commonjs2'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li><p>resolve, resolveLoader的配置，控制模块以及loader的解析查找，文件后缀，模块主字段读取，模块主文件查找</p></li> <li><p>use规则中对于规则通过oneOf方式建立，这样可以使得规则匹配执行一次</p></li> <li><p>引入thread-loader通过开启多进程完成构建速度提升</p></li> <li><p>speed-measure-webpack-plugin统计构建过程中的速度监测</p></li> <li><p>noParse的配置，对于不需要分析依赖的模块开启</p></li> <li><p>ignore-plugin配置忽略过多的不需要模块引入</p></li> <li><p>tree-shaking 去除没有使用的代码</p></li> <li><p>host scope 作用域提升</p></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/test.html" class="prev">
        测试
      </a></span> <span class="next"><a href="/blog/structor/tapable.html">
        tapable
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.a3423334.js" defer></script><script src="/blog/assets/js/2.a973bc12.js" defer></script><script src="/blog/assets/js/41.91a0c3cd.js" defer></script>
  </body>
</html>
