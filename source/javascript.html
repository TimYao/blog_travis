<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>原理深入 | 知识文章</title>
    <meta name="generator" content="VuePress 1.4.1">
    
    <meta name="description" content="This is a blog.">
    <link rel="preload" href="/blog/assets/css/0.styles.eea3ff88.css" as="style"><link rel="preload" href="/blog/assets/js/app.a3423334.js" as="script"><link rel="preload" href="/blog/assets/js/2.a973bc12.js" as="script"><link rel="preload" href="/blog/assets/js/35.89ff95b9.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.874ad3ec.js"><link rel="prefetch" href="/blog/assets/js/11.0711065f.js"><link rel="prefetch" href="/blog/assets/js/12.c40d93da.js"><link rel="prefetch" href="/blog/assets/js/13.da43d7f3.js"><link rel="prefetch" href="/blog/assets/js/14.5f50c20e.js"><link rel="prefetch" href="/blog/assets/js/15.d82d9cf0.js"><link rel="prefetch" href="/blog/assets/js/16.ff02c56f.js"><link rel="prefetch" href="/blog/assets/js/17.902c3621.js"><link rel="prefetch" href="/blog/assets/js/18.690ad6d6.js"><link rel="prefetch" href="/blog/assets/js/19.e8feab27.js"><link rel="prefetch" href="/blog/assets/js/20.1d7fcf1c.js"><link rel="prefetch" href="/blog/assets/js/21.16c4ed2a.js"><link rel="prefetch" href="/blog/assets/js/22.2aefa173.js"><link rel="prefetch" href="/blog/assets/js/23.4e5640f3.js"><link rel="prefetch" href="/blog/assets/js/24.ba1b495a.js"><link rel="prefetch" href="/blog/assets/js/25.e8666563.js"><link rel="prefetch" href="/blog/assets/js/26.5787142e.js"><link rel="prefetch" href="/blog/assets/js/27.b2722766.js"><link rel="prefetch" href="/blog/assets/js/28.5aa26eb0.js"><link rel="prefetch" href="/blog/assets/js/29.3d2624e8.js"><link rel="prefetch" href="/blog/assets/js/3.f86f4f75.js"><link rel="prefetch" href="/blog/assets/js/30.29661336.js"><link rel="prefetch" href="/blog/assets/js/31.447afcaa.js"><link rel="prefetch" href="/blog/assets/js/32.c2bd8e9a.js"><link rel="prefetch" href="/blog/assets/js/33.797423e5.js"><link rel="prefetch" href="/blog/assets/js/34.ee1d27eb.js"><link rel="prefetch" href="/blog/assets/js/36.a6567a31.js"><link rel="prefetch" href="/blog/assets/js/37.e0cd8c86.js"><link rel="prefetch" href="/blog/assets/js/38.4ca67963.js"><link rel="prefetch" href="/blog/assets/js/39.4bec9a8a.js"><link rel="prefetch" href="/blog/assets/js/4.221a248a.js"><link rel="prefetch" href="/blog/assets/js/40.6b72df98.js"><link rel="prefetch" href="/blog/assets/js/41.91a0c3cd.js"><link rel="prefetch" href="/blog/assets/js/42.c495687d.js"><link rel="prefetch" href="/blog/assets/js/43.fc90ceb9.js"><link rel="prefetch" href="/blog/assets/js/44.5da0fdd6.js"><link rel="prefetch" href="/blog/assets/js/5.d9260729.js"><link rel="prefetch" href="/blog/assets/js/6.e532ac18.js"><link rel="prefetch" href="/blog/assets/js/7.d43e6edf.js"><link rel="prefetch" href="/blog/assets/js/8.0d7bba76.js"><link rel="prefetch" href="/blog/assets/js/9.d2e1456d.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.eea3ff88.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">知识文章</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/TimYao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/TimYao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/jsdoc.html" class="sidebar-link">JS</a></li><li><a href="/blog/all.html" class="sidebar-link">Html/Css</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端框架</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/blog/test.html" class="sidebar-link">测试</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>构建工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>服务端</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/blog/replease.html" class="sidebar-link">发布上线</a></li><li><a href="/blog/expand.html" class="sidebar-link">扩展知识</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>源码分析</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/source/axios.html" class="sidebar-link">axios</a></li><li><a href="/blog/source/promise.html" class="sidebar-link">promise</a></li><li><a href="/blog/source/javascript.html" class="active sidebar-link">javascript</a></li></ul></section></li><li><a href="/blog/resource.html" class="sidebar-link">资料</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>项目实践</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/blog/sf.html" class="sidebar-link">算法学习</a></li><li><a href="/blog/408.html" class="sidebar-link">计算机408课本</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="原理深入"><a href="#原理深入" class="header-anchor">#</a> 原理深入</h3> <ul><li><p>new 实现</p> <p>思路：</p> <ol><li><p>创建一个新对象</p></li> <li><p>将构造函数的prototype指向到新对象的原型链上</p></li> <li><p>将构造函数中的this指向到新创建的对象</p></li> <li><p>如果该构造函数返回的是对象那直接返回，若不是返回新创建对象</p></li></ol> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">createObject</span><span class="token punctuation">(</span><span class="token parameter">constructor</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token function">constructor</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    obj<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> constructor<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">typeof</span> r <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">?</span> r <span class="token operator">:</span> obj<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>call/apply/bind</p> <p>call 方法思想 主要是为了完成函数中this对象的指向,改变函数执行的上下文，通过fn.call(context)</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">const</span> call <span class="token operator">=</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">call</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context <span class="token operator">=</span> context <span class="token operator">?</span> <span class="token function">Object</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">:</span> window<span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      args<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'arguments['</span> <span class="token operator">+</span> i <span class="token operator">+</span> <span class="token string">']'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">'context.fn('</span> <span class="token operator">+</span> args <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">delete</span> context<span class="token punctuation">.</span>fn<span class="token punctuation">;</span>
    <span class="token keyword">return</span> r<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fn'</span><span class="token punctuation">,</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> <span class="token function-variable function">fn1</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fn1'</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  fn<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>fn1<span class="token punctuation">,</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>apply原理实现:</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">const</span> apply <span class="token operator">=</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">apply</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context <span class="token operator">=</span> context <span class="token operator">?</span> <span class="token function">Object</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">:</span> window<span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">'context.fn('</span> <span class="token operator">+</span> args <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">delete</span> context<span class="token punctuation">.</span>fn<span class="token punctuation">;</span>
    <span class="token keyword">return</span> r<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fn'</span><span class="token punctuation">,</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> <span class="token function-variable function">fn1</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fn1'</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>fn1<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>bind实现原理:</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">const</span> bind <span class="token operator">=</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">bind</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    context <span class="token operator">=</span> context <span class="token operator">?</span> <span class="token function">Object</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">:</span> window<span class="token punctuation">;</span>
    <span class="token keyword">const</span> bindArgs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    fn<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>prototype
    <span class="token keyword">function</span> <span class="token function">bindFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">that</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">bindFn</span> <span class="token operator">?</span> <span class="token keyword">this</span> <span class="token operator">:</span> context<span class="token punctuation">,</span> bindArgs<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    bindFn<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> bindFn<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">const</span> <span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fn'</span><span class="token punctuation">,</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  fn<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">show</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fn show'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token keyword">const</span> <span class="token function-variable function">fn1</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fn1'</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> fn2 <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">{</span>a<span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">,</span><span class="token number">34</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> c3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c3<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>instanceOf 实现: 循环查询该实例链上是否有构造函数的原型</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">createInstanceOf</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">A</span><span class="token punctuation">,</span><span class="token constant">B</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> proto <span class="token operator">=</span> <span class="token constant">A</span><span class="token punctuation">.</span>__proto__<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>proto <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>proto <span class="token operator">===</span> <span class="token class-name">B</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      proto <span class="token operator">=</span> proto<span class="token punctuation">.</span>__proto__<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token constant">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  es6<span class="token operator">:</span>实现方式
  <span class="token keyword">class</span> <span class="token class-name">S</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>hasInstance<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">typeof</span> str<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hello'</span> instanceOf <span class="token constant">S</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  es5<span class="token operator">:</span> 实现方式
  <span class="token keyword">function</span> <span class="token constant">S</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token constant">S</span><span class="token punctuation">,</span> Symbol<span class="token punctuation">.</span>hasInstance<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">typeof</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    enumerable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    writable<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token string">'hello'</span> instanceOf <span class="token constant">S</span>   <span class="token comment">// true</span>
  <span class="token constant">S</span><span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>hasInstance<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>

  <span class="token function">createInstanceOf</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> Object<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>执行上下文，作用域链，this</p></li> <li><p>深度拷贝，浅度拷贝: 对象的深度拷贝一个新的，修改下不会影响到原先对象， ...,object.assign,Array.prototype.slice都为浅拷贝</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">deepObject</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> weakMap</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">RegExp</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token keyword">instanceof</span> <span class="token class-name">Date</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> obj <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> weakmap <span class="token operator">=</span> weakMap <span class="token operator">||</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>weakmap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> constr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">obj<span class="token punctuation">.</span>constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    weakmap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span><span class="token string">'hasOwnProperty'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        constr<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> weakmap<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> constr<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token operator">:</span><span class="token string">'ni'</span><span class="token punctuation">,</span>b<span class="token operator">:</span><span class="token punctuation">{</span>c<span class="token operator">:</span><span class="token string">'h'</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
  obj<span class="token punctuation">.</span>d <span class="token operator">=</span> obj<span class="token punctuation">;</span>
  <span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token function">deepObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>原型链</p> <p>任何function上都有原型prototype, 任何对象上都有原型链__proto__,由于__proto__指向构造函数的prototype,而又由于prototype下有__proto__,因此形成了原型链，查找由自身是否具有到原型链上查找，直到找到根Object.prototype.<strong>proto</strong> = null,这里有两个特殊的Function, Object,他们都是即有prototype,又有__proto__,所以Function.<strong>proto</strong> === Function.prototype, Object.<strong>proto</strong> === Function.prototype,因此 Function.<strong>proto</strong> == Object.<strong>proto</strong></p></li> <li><p>类型之间转换</p> <p>隐式转换(if, !, 类型之间的+,-,*,/,%等运算方式, 比较运算符/==, 单目运算)</p> <p>0, '', false, null, undefined为false</p> <p>单目运算转换 +</p> <p>显示转换(number,string,boolean,object等)</p> <p>转换分为原始类型之间，原始类型与引用类型</p> <p>原始类型之间：</p> <div class="language- extra-class"><pre><code>操作符为+，操作数优先做字符拼接，其他情况都会转换为数字来进行操作，null,undefined,nan
</code></pre></div><p>原始类型与引用类型:</p> <div class="language- extra-class"><pre><code>先将对象转换为原始类型，再进行原始类型之间的转换规则，对于对象转换为原始类型，通过对象内部的toprimitive,valueof,tostring顺序来完成，toprimitive可以改写后两者的返回，顺序调用直到返回原始类型，否则以[object object]
</code></pre></div><p>对于比较运算(&gt;,&lt;,==,&lt;=,&gt;=)等进行转为数字类型来比较</p> <p>特殊类型</p> <p>null/undefined/nan 与0相比都为false</p> <p>null == undefined true</p> <p>特殊例子： [] == ![] true</p></li></ul> <br> <h3 id="重点知识"><a href="#重点知识" class="header-anchor">#</a> 重点知识</h3> <ul><li><p>this运行原理</p> <p>由于js引擎运行原理  通过预编译，运行两个阶段，在脚本语句定义后，通过对语句中变量的声明，以及变量内存分配，以及作用域的形成，此时变量并没有分配值，当处于运行阶段时，对变量赋值，完成脚本运行</p> <p>this为当前执行环境所属，即调用方法对象指向，全局作用域、对象调用、call/apply/bind转换对象作用域、箭头函数、new实例化，全局作用域分为普通模式与严格模式（'use struct'）,普通作用域指向window、global,严格模式指向undefined</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">globalfun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// window</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">globalfun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token string">'use struct'</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefine</span>
  <span class="token punctuation">}</span>
</code></pre></div><p><strong>对象调用方式，函数内部this指向所属对象</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span><span class="token string">'this is name'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">fun</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// obj</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  obj<span class="token punctuation">.</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>通过call,apply,bind显示转换this指向</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span><span class="token string">'this is name1'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">fun</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// obj2</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span><span class="token string">'this is name2'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">fun</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  obj1<span class="token punctuation">.</span><span class="token function">fun</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span>
</code></pre></div><p><strong>箭头函数中不存在this，this所属与定义箭头函数上层函数</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">tt</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">settimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// window</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">settimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// obj</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  obj<span class="token punctuation">.</span><span class="token function">tt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>new实例化绑定this</strong></p> <div class="language- extra-class"><pre><code>new fun()

new操作目的创建一个新对象，将构函数this对象指向新对象，实现对象的属性方法

var obj = {}
fun.call(obj)
obj.__pro__ = fun.prototype
</code></pre></div><p><strong>关于显式隐式优先级</strong></p> <div class="language- extra-class"><pre><code>隐式模式低于，call/apply/bind低于new;箭头函数不受内层决定，受上层环境影响决定
</code></pre></div></li></ul> <br> <ul><li><p>闭包（作用域，作用域链，执行上下文，内存管理）</p> <p>作用域一个变量的查找规则，当预编译时决定，作用域链是在执行阶段由编译阶段的变量对象转为活动对象包含了当前调用的作用域和上层可访问的活动对象,作用域链为作用域查找的扩展</p> <p>执行上下文，即语句执行环境，执行环境，当语句运行结束后，释放当前执行环境，也就是每一次执行都会创建一个执行环</p> <p>闭包主要为通过作用域链来实现外层访问内存变量，由于内层函数运行释放后，但由于外层引用了返回函数，返回函数引入内层函数变量，所以形成不能释放的变量，即闭包变量</p></li></ul> <br> <ul><li><p>对于严格模式与非严格模式</p> <p>严格模式的出现为了解决早期一些JS不友好问题:</p> <ol><li><p>使之前的静默错误显示</p></li> <li><p>提高了静态性分析，提示了js引擎的编译代码优化</p></li> <li><p>为未来提供了一个过渡话的延伸</p></li></ol> <p>对于设置了defineProperty属性定义不可写，没有读属性功能等提示错误，包括对属性的冻结，阻止扩展，密封</p> <p>在删除一些变量通过delete方法提示错误，对未定义变量全局话使用也会报错</p> <p>对arguments,fn.caller,fn.arguments,with提供了静态分析，以及取消关联</p> <p>对eval提供了独立的作用域，不会影响外层变量覆盖问题，对于this的管理，不支持动态改变this对象指向（通过apply,call,bind）</p> <p>对this的调用，一般函数返回均为对象，但严格模式下，全局中this为undefine,非对象通过apply,call,bind返回的原始值</p> <p>我们对开启严格模式，注意代码的统一，防止严格与非严格冲突，通常，我们可以针对需要的地方开始严格</p></li></ul> <br> <ul><li><p>关于跨域解决方案总结</p> <ol><li><p>与服务器之间的通信方式</p> <p>jsonp:</p> <p>由于javascript本身访问不受浏览器限制，可以与后端约定好请求返回提前我们定义的函数运行,后端返回拼写函数调用方式,这种方式只支持get方式，并且若返回的代码里有脚本，容易操作xss攻击</p> <div class="language-js extra-class"><pre class="language-js"><code>  window<span class="token punctuation">.</span><span class="token function-variable function">fn</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;text/javascript&quot;</span> src<span class="token operator">=</span><span class="token string">&quot;http://www.a.com?callback=fn&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>cosr跨站请求:</p> <p>前端通过正常的方式请求，犹豫在非同源情况下会出现跨域（协议不同，端口不同，域名不同），我们需要配置后端,返回头信息，犹豫浏览器本身的拦截</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Acess-Control-Allow-Origin'</span><span class="token punctuation">,</span> 域名<span class="token punctuation">)</span>  <span class="token comment">// 设置是否支持跨域的访问</span>

  <span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Acess-Control-Allow-header'</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">)</span> <span class="token comment">// 允许客服端可以访问getrequestheaders(name)</span>

  <span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Acess-Control-Allow-Creadients'</span><span class="token punctuation">)</span>   <span class="token comment">// 在跨域情况下，需要设置是否同意带上COOKies请求</span>

  <span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Acess-Control-Allow-Method'</span><span class="token punctuation">,</span> <span class="token string">'put'</span><span class="token punctuation">)</span>  <span class="token comment">// 设置支持的请求方法</span>

  <span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Acess-Control-Allow-Max-Age'</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span>   <span class="token comment">// 设置在出现需要options控制预检查请求的延迟</span>
</code></pre></div><p>nginx配置</p> <p>一种直接开启允许头信息来配置支持
add_header</p> <p>一种通过路由转发跳转到支持的服务，最后返回到我们的访问的地址</p> <p>http proxy</p> <p>这中方式与nginx第二种基本模式相同，但由前端配置，通过发送前端方式的请求转发模式（可以再补充点资料）</p></li> <li><p>标签页之间的通信</p> <p>iframe方式:</p> <div class="language- extra-class"><pre><code> 1. 通过window.name方式，原理为由于窗口共享一个window.name标识，若a,c为同域，b为跨域,首先通过a iframe到b, b中设置了window.name值,当iframe加载完成，修改地址为c，同时控制加载不能重复运行,这样可以通过window.iframe[name].contentWindow.name取到值，由于同域了可以访问window.iframe[name].contentWindow

 2. 通过iframe嵌套hash传值，若a,c为同域，b为不同域,a 引入b将a中的值通过hash传入，b中可以通过值，将需要需要通知的消息放入通过引入c

 3. 通过设置document.domain方式，不过这种方式有显示的，当通信页面之间为部分同属一个域，这样只要分别设置两个页面的domain,指向他们的共享域地址
</code></pre></div><p>postMessage:</p> <div class="language- extra-class"><pre><code> 这种方式优势简单，并且不需要任何设置，但低版本不支持，高级版本均支持,通过iframe引入要交流的页面，本页面设置window.postMessage(message,targetOrigin),window.onmessage=function(event){event.data/event.origin },在通信页面下设置，window.onmessage=function(event){evet.data/event.source.postMessage(message, targetOrigin)}
</code></pre></div><p>websocket:</p> <div class="language- extra-class"><pre><code> 建立在tcp下的一个新的协议组成，ws/wss,本质支持跨域访问，且为双向通信，一般低版本不支持，可以通过socket.io兼容支持

 客户端正常请求，后端通过引入ws库
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>  websocket <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ws'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">websocket<span class="token punctuation">.</span>server</span><span class="token punctuation">(</span><span class="token punctuation">{</span> port<span class="token operator">:</span> <span class="token number">8080</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">ws</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">incoming</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'received: %s'</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'something'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  server client
  <span class="token keyword">let</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:8000/test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 打开WebSocket连接后立刻发送一条消息:</span>
  ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[CLIENT] open()</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 响应收到的消息:</span>
  ws<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[CLIENT] Received: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  前端：
  <span class="token keyword">var</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:8000/test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ol></li></ul> <br> <ul><li><p>es6常考虑点</p> <ol><li><p>let,const,var作用域</p></li> <li><p>解构（数组，对象，字符串）</p> <p>spread or reset</p> <p>对象合并问题（深度，浅度）拷贝</p></li> <li><p>Object.defineProperty</p> <p>默认定义的方式不可修改</p> <div class="language-js extra-class"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'kk'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  enumerable<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
  writeable<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
  value<span class="token operator">:</span><span class="token number">111</span><span class="token punctuation">,</span>
  configurable<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dd'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">set</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>writable/value/get/set不能共存</p></li> <li><p>对象（es5/es6）定义实例继承</p> <p>实例继承  parent.apply/call(this, args)</p> <p>原型继承</p> <div class="language-js extra-class"><pre class="language-js"><code>  sub<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> parent<span class="token punctuation">.</span>prototype

  sub<span class="token punctuation">.</span>prototype <span class="token operator">=</span> object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>

  sub<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> sub<span class="token punctuation">;</span>

  object<span class="token punctuation">.</span><span class="token function">setprototype</span><span class="token punctuation">(</span>sub<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> parent<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>静态继承</p> <div class="language-js extra-class"><pre class="language-js"><code>  sub<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> parent

  object<span class="token punctuation">.</span><span class="token function">setprototype</span><span class="token punctuation">(</span>sub<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>es5中原型方法可以遍历，在利用es5实现es6方法，注意这点，重新定义类上的原型方法和静态方法,检查调用是否为实例化调用，对返回的是否为其他对象，若为其他则返回，否则返回当前this</p></li> <li><p>装饰器</p></li> <li><p>一些方法运用</p> <p>reduce/symbol简单了解/set(交并差级)/map完成</p></li></ol></li></ul> <br> <ul><li><p>xss/csrf安全</p> <p>xss</p> <ol><li><p>base dom</p> <p>在DOM节点上做一些因为未解析而导致代码运行，例如在img标签上挂上onerror发起请求</p></li> <li><p>反射</p> <p>通过在地址栏中参数中有脚本，当后端返回后，在页面中加载了</p> <p>encodeUrlComponent 进行编码</p></li> <li><p>数据库存储</p> <p>这种主要针对表单提交，在提交中有脚本内容，但后端直接存储到数据库中，当后端返回直接插入到页面导致，需要前后端都过滤&lt; &gt; &quot; '等符号</p></li></ol></li></ul> <br> <ul><li><p>断点续传</p> <p>通过对头信息的范围控制来完成
client
headers{Range: bytes=start-end, Accept-Bytes:bytes}
server
headers{Content-Range: start-end/total}</p></li></ul> <br> <ul><li><p>正向代理，反向代理</p> <p>代理服务: 主要是协助真是服务完成一些操作</p> <p>正向代理: 主要是相对服务器而言客户端为透明的，
代理服务器协助客户端完成发送操作
例如：VPN</p> <p>反向代理: 主要是相对客户端服务端是透明的，
代理协助服务端完成操作
例如：负载，CDN, 转发请求</p></li></ul> <br> <ul><li><p>多包语言</p> <p>(1). 通过两版本页面，访问不同地址</p> <p>(2). 通过前端语言包库，在渲染时完成对应传入，例如vue-il18</p> <p>(3). 通过服务端提供语言包，在头信息中带入accept-language,后端处理返回对应信息</p></li></ul> <br> <ul><li><p>防盗链</p> <p>由于自己服务器上的资源在被其他服务器上的页面引用时，通过访问方式而占据了原本服务的资源流量等，所以通过防止其他外站引用资源防护。在本服务器中通过验证请求资源所携带的referer与请求头host是否为同一个服务器，如果是可以正常访问，如果不是则打连接到其他资源，某些时候，我们是可以跳过防盗链防护的</p> <p>有以下方式：</p> <div class="language- extra-class"><pre><code>资源被引入的外站页面头部添加
&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot;&gt;

资源img标签上添加
&lt;img src=&quot;pic&quot; referrerpolicy=&quot;no-referrer&quot;&gt;

设置响应头
res.setHeader('Referrer-Policy','no-referrer')

通过代理服务，访问自身假资源，在服务端处理代理转发
</code></pre></div></li></ul> <br> <ul><li><p>压缩，解压</p> <p>目前支持压缩gzip,deflate,br,通过头信息accept-encoding,
content-encoding来完成</p></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/source/promise.html" class="prev">
        promise
      </a></span> <span class="next"><a href="/blog/resource.html">
        资料
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.a3423334.js" defer></script><script src="/blog/assets/js/2.a973bc12.js" defer></script><script src="/blog/assets/js/35.89ff95b9.js" defer></script>
  </body>
</html>
